<!-- Breadcrumbs -->
<div class='flex items-center text-sm text-gray-600 space-x-2'>
  <a href='/' class='text-black hover:underline'>
    Trang chủ
  </a>
  <span>
    <i class='fas fa-angle-right'></i>
  </span>
  <a href='/' class='text-black hover:underline'>
    {{product.category.name}}
  </a>
  <span>
    <i class='fas fa-angle-right'></i>
  </span>
  <span class='text-green-600'>
    {{product.name}}
  </span>
</div>

<!-- Main Content -->
<div class='mt-4 mb-4 p-4 bg-white rounded shadow'>
  <div class='grid md:grid-cols-2 gap-6'>
    <!-- Product Images -->
    <div>
      <div class='mb-3'>
        <img
          src="{{product.image_url}}"
          alt="{{product.name}}"
          class='w-full h-[400px] object-contain rounded border'
          id='mainImage'
        />
      </div>
      <div class='flex gap-2 overflow-x-auto'>
        <img
          src="{{product.image_url}}"
          class='w-20 h-20 object-cover rounded border-2 cursor-pointer active-thumb'
          onclick='updateMainImage(this)'
        />
        {{#if product.gallery}}
          {{#each product.gallery}}
            <img
              src="{{this}}"
              class='w-20 h-20 object-cover rounded border cursor-pointer'
              onclick='updateMainImage(this)'
            />
          {{/each}}
        {{/if}}
      </div>
    </div>

    <!-- Product Info -->
    <div>
      <div class='flex items-center space-x-2 mb-2'>
        <span
          class='inline-block bg-green-100 text-green-800 text-sm px-2 py-1 rounded'
        >
          Còn hàng
        </span>
        {{#if product.rating}}
          <div class='text-yellow-500 text-sm'>
            ★★★★★
            <span class='text-gray-500'>
              ({{product.reviewCount}} đánh giá)
            </span>
          </div>
        {{/if}}
      </div>

      <h1 class='text-xl font-semibold mb-3'>
        {{product.name}}
      </h1>

      <div class='space-y-2 text-sm text-gray-600 mb-4'>
        <div class='flex gap-2'>
          <span>
            Gửi từ:
          </span>
          <span>
            {{product.location}}
          </span>
        </div>
        <div class='flex gap-2'>
          <span>
            Khu vực giao hàng:
          </span>
          <span>
            Chọn khu vực
          </span>
        </div>
        <div class='flex gap-2'>
          <span>
            Vận chuyển:
          </span>
          <span>
            Nhanh
          </span>
        </div>
      </div>

      <div class='mb-4'>
        <div class='text-sm text-gray-600 mb-2'>
          Phân loại:
        </div>
        <div class='flex gap-2'>
          {{#each product.variants}}
            <div
              class='p-1 border hover:border-green-600 cursor-pointer rounded'
            >
              <img
                src="{{this.image}}"
                alt="{{this.name}}"
                class='w-12 h-12 object-cover rounded'
              />
            </div>
          {{/each}}
        </div>
      </div>

      <div class='mb-4'>
        <div class='text-sm text-gray-600 mb-2'>
          Số lượng:
        </div>
        <div class='flex items-center w-32'>
          <button
            type='button'
            onclick='decrementQuantity()'
            class='px-2 py-1 border rounded-l hover:bg-gray-100'
          >
            −
          </button>
          <input
            type='number'
            id='quantity'
            value='1'
            min='1'
            class='w-full text-center border-t border-b focus:outline-none'
          />
          <button
            type='button'
            onclick='incrementQuantity()'
            class='px-2 py-1 border rounded-r hover:bg-gray-100'
          >
            +
          </button>
        </div>
      </div>

      <div class='mb-4'>
        <h3 class='text-2xl text-red-600 font-semibold'>
          {{formatCurrency product.price}}
        </h3>
      </div>

      <div class='flex gap-2'>
        <button
          onclick="addToCart('{{product._id}}')"
          class='w-full border border-green-600 text-green-600 rounded py-2 hover:bg-green-50'
        >
          Thêm vào giỏ hàng
        </button>
        <button
          onclick="buyNow('{{product._id}}')"
          class='w-full bg-green-600 text-white rounded py-2 hover:bg-green-700'
        >
          Mua ngay
        </button>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class='mt-6'>
    <div class='border-b flex space-x-4 text-sm'>
      <button class='py-2 px-4 border-b-2 border-green-600 font-semibold'>
        Chi tiết
      </button>
      <button class='py-2 px-4 text-gray-600 hover:text-black'>
        Đánh giá ({{product.reviewCount}})
      </button>
    </div>

    <div class='mt-4'>
      <p>
        {{product.description}}
      </p>

      <div class='mt-6'>
        {{#if product.reviews}}
          {{#each product.reviews}}
            <div class='mb-6'>
              <div class='flex items-center gap-3 mb-2'>
                <img
                  src="{{this.user.avatar}}"
                  class='w-10 h-10 rounded-full object-cover'
                />
                <div class='flex-1'>
                  <h6 class='font-semibold mb-1'>
                    {{this.user.name}}
                  </h6>
                  <div class='text-yellow-500'>
                    {{formatAverageRating this.rating}}
                  </div>
                </div>
                <small class='text-gray-400'>
                  {{formatDate this.createdAt}}
                </small>
              </div>
              <p class='text-gray-700'>
                {{this.comment}}
              </p>
            </div>
          {{/each}}
        {{else}}
          <p class='text-gray-400'>
            Chưa có đánh giá nào cho sản phẩm này.
          </p>
        {{/if}}
      </div>
    </div>
  </div>
</div>